_format_version: "3.0"

plugins:
  - name: cors
    tags: [cors-default]
    config:
      origins: ["http://localhost:5173"]
      methods: [GET, POST, PUT, DELETE, OPTIONS]
      headers: [Accept, Content-Type, Authorization, X-User-Name, X-User-Role]
      exposed_headers: [Authorization]
      credentials: true
      max_age: 3600

  - name: request-transformer
    tags: [auth-default]
    config:
      add:
        headers: # TODO: change this, it's just for testing
          - "X-User-Name:development-user"
          - "X-User-Role:user"

consumers:
  - username: authenticated-users
    tags: [auth-default]
    keyauth_credentials:
      - key: auth-token-key

services:
  - name: auth-service
    url: http://auth:8080
    routes:
      - name: auth-route
        paths: ["/auth"]
        strip_path: true
    tags: [cors-default]

  - name: upload-service
    url: http://upload:6565
    routes:
      - name: upload-route
        paths: ["/upload"]
        strip_path: false
    tags: [cors-default, auth-default]

  - name: download-service
    url: http://download:8012
    routes:
      - name: download-route
        paths: ["/download"]
        strip_path: false
    tags: [cors-default, auth-default]
